(()=>{"use strict";var t={945:(t,e,i)=>{i.r(e)},934:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AppController=void 0;const s=i(163);e.AppController=class{constructor(t){this.model=t,this.view=new s.AppView(this,t),this.view.createInputContainer(),this.view.disableSubmitButton(),this.model.initialize()}validateFormData(t){if(t.sheet&&t.pipe&&t.length&&t.width&&t.strength){const e=this.transformUserData(t),i=this.model.getFrameLimit();e.length>=i.length.min&&e.length<=i.length.max&&e.width>=i.width.min&&e.width<=i.width.max?this.view.enableSubmitButton():this.view.disableSubmitButton()}else this.view.disableSubmitButton()}transformUserData(t){return Object.assign(Object.assign({},t),{length:Number.parseInt(t.length,10),width:Number.parseInt(t.width,10)})}calcRequiredMaterial(t){const e=this.transformUserData(t);this.model.calcRequiredMaterial(e)}}},877:function(t,e,i){var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function r(t){try{o(s.next(t))}catch(t){a(t)}}function l(t){try{o(s.throw(t))}catch(t){a(t)}}function o(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}o((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.AppModel=void 0;const n=i(658);e.AppModel=class{constructor(){this.productsData=[],this.calculationRules=[],this.sheets=[],this.pipes=[],this.strengths=[],this.frameLimit=null,this.inputStaticDataObservers=[],this.tableResultsObserver={},this.materialCalculationResults=[],this.miniFrame={},this.productDataResult={}}initialize(){return s(this,void 0,void 0,(function*(){const t=yield fetch("https://raw.githubusercontent.com/Vistegra/test-calc-js/master/data/data.json");this.productsData=yield t.json();const e=yield fetch("https://raw.githubusercontent.com/Vistegra/test-calc-js/master/data/config.json");this.calculationRules=yield e.json(),this.notifyInputStaticDataObservers()}))}registerInputStaticDataObservers(t){this.inputStaticDataObservers.push(t)}notifyInputStaticDataObservers(){var t;for(let e=0;e<this.inputStaticDataObservers.length;e+=1)null===(t=this.inputStaticDataObservers[e])||void 0===t||t.updateInputStaticData()}registerTableResultsObserver(t){this.tableResultsObserver=t}notifyTableResultsObserver(){this.tableResultsObserver.updateResults()}getSheets(){return 0!==this.sheets.length||(this.sheets=this.productsData.filter((t=>t.type===n.ObjectTypes.SHEET))),this.sheets}getPipes(){return 0!==this.pipes.length||(this.pipes=this.productsData.filter((t=>t.type===n.ObjectTypes.PIPE))),this.pipes}getStrengths(){return 0!==this.strengths.length||(this.strengths=this.calculationRules.filter((t=>t.type===n.ObjectTypes.FRAME))),this.strengths}getFrameLimit(){if(null!==this.frameLimit)return this.frameLimit;const t=this.calculationRules.filter((t=>t.type===n.ObjectTypes.SIZE)),e={};for(let i=0;i<t.length;i+=1){const s=t[i];"length"===(null==s?void 0:s.key)&&(e.length={min:s.min,max:s.max}),"width"===(null==s?void 0:s.key)&&(e.width={min:s.min,max:s.max})}return this.frameLimit=e,this.frameLimit}getCalcResults(){return this.materialCalculationResults}getMiniFrame(){return this.miniFrame}getProductDataResult(){return this.productDataResult}calcRequiredMaterial(t){this.materialCalculationResults=[];const e=this.sheets.find((e=>e.name===t.sheet)),i=this.pipes.find((e=>e.name===t.pipe)),s=this.strengths.find((e=>e.name===t.strength)),a=this.productsData.find((t=>t.type===n.ObjectTypes.SCREW)),r=this.calculationRules.find((t=>t.type===n.ObjectTypes.SCREW&&t.key===e.material)),l=i.width/1e3,o=s.step>e.width?e.width:s.step,u=Math.floor(e.width/o),h=1-2*l,c=o-2*l,m=c*h,d=t.width*t.length,p=d/m,b=p/u,f=t.width/1+1,g=t.length/o,v=Math.ceil(g)+1,w=(t.length-v*l)*f+(t.width-f*l)*v,y=p*(m*r.value),S=b*e.price,E=w*i.price,O=y*a.price;this.materialCalculationResults.push({name:e.name,unit:e.unit,overallMaterial:Math.ceil(b),totalCost:+S.toFixed(2)}),this.materialCalculationResults.push({name:i.name,unit:i.unit,overallMaterial:Math.ceil(w),totalCost:+E.toFixed(2)}),this.materialCalculationResults.push({name:a.name,unit:a.unit,overallMaterial:Math.ceil(y),totalCost:+O.toFixed(2)}),this.miniFrame={length:h,width:c},this.productDataResult={frameArea:d,miniFrame:this.miniFrame,totalCost:+this.materialCalculationResults.reduce(((t,e)=>t+e.totalCost),0).toFixed(2)},this.notifyTableResultsObserver()}}},163:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AppView=void 0,e.AppView=class{constructor(t,e){this.form=null,this.submitButton=null,this.controller=t,this.model=e,this.model.registerInputStaticDataObservers(this),this.model.registerTableResultsObserver(this)}draw(){document.body.innerHTML=""}createInputContainer(){var t,e,i;this.form=document.querySelector(".form"),this.submitButton=null===(t=this.form)||void 0===t?void 0:t.querySelector(".button"),null===(e=this.form)||void 0===e||e.addEventListener("submit",(t=>{if(t.stopPropagation(),t.preventDefault(),null!==this.form){const t=Object.fromEntries(new FormData(this.form));console.log(t,"submit"),this.controller.calcRequiredMaterial(t)}})),null===(i=this.form)||void 0===i||i.addEventListener("click",(t=>{if(null!==this.submitButton&&t.target!==this.submitButton&&null!==this.form){const t=Object.fromEntries(new FormData(this.form));this.controller.validateFormData(t)}})),this.getFormFieldByName(this.form,"width").addEventListener("input",this.handleNumberInput(this.form)),this.getFormFieldByName(this.form,"length").addEventListener("input",this.handleNumberInput(this.form))}handleNumberInput(t){let e="";return i=>{const s=i.target,{value:n}=s;n.length>0&&!Number.isNaN(Number.parseInt(n[n.length-1],10))?(e=n,t.click()):0===n.length?e=n:s.value=e}}updateInputStaticData(){console.log("data is loaded"),this.drawSheetList(this.model.getSheets()),this.drawPipeList(this.model.getPipes()),this.drawStrengthList(this.model.getStrengths())}updateResults(){this.drawProduct(this.model.getProductDataResult(),this.model.getCalcResults())}drawSheetList(t){null!==this.form&&this.drawSelectOptionsElement(this.form,"sheet",t)}drawPipeList(t){null!==this.form&&this.drawSelectOptionsElement(this.form,"pipe",t)}drawStrengthList(t){null!==this.form&&this.drawSelectOptionsElement(this.form,"strength",t)}enableSubmitButton(){null!==this.submitButton&&this.submitButton.removeAttribute("disabled")}disableSubmitButton(){null!==this.submitButton&&this.submitButton.setAttribute("disabled","")}drawSelectOptionsElement(t,e,i){const s=Array.from(t.elements).find((t=>t.getAttribute("name")===e));this.removingCustomOptionElements(s,"default"),i.forEach((t=>{const e=document.createElement("option");e.textContent=t.name,s.add(e)}))}removingCustomOptionElements(t,e){var i;let s=t.options.length-1;for(;1!==t.options.length;)(null===(i=t.item(s))||void 0===i?void 0:i.getAttribute("value"))===e?s-=1:(t.remove(s),s=t.options.length-1)}getFormFieldByName(t,e){return Array.from(t.elements).find((t=>t.getAttribute("name")===e))}drawProduct(t,e){const i=this.createElement("div");i.classList.add("product");const s=this.createElement("p");s.classList.add("mb-0"),s.textContent=`Площадь изделия: ${t.frameArea}м2`;const n=this.createElement("p");n.textContent=`Размер ячейки ДхШ: ${t.miniFrame.length}х${t.miniFrame.width}м`;const a=this.createElement("p");a.classList.add("mb-0"),a.textContent="Кол-во материалов:";const r=this.drawTableResults(e),l=this.createElement("p");l.textContent=`Итоговая стоимость: ${t.totalCost}`,i.append(s,n,a,r,l);const o=document.querySelector(".result-container");o.innerHTML="",o.append(i)}drawTableResults(t){const e=document.createElement("table");e.classList.add("table","table-hover");const i=document.createElement("thead");i.classList.add("table-dark");const s=document.createElement("tr"),n=["Наименование","ед.","кол-во","сумма"].map((t=>{const e=document.createElement("th");return e.textContent=t,e}));s.append(...n),i.append(s);const a=document.createElement("tbody");for(let e=0;e<t.length;e+=1){const i=this.createElement("tr"),s=Object.values(t[e]).map((t=>{const e=this.createElement("td");return e.textContent=t,e}));i.append(...s),a.append(i)}return e.append(i,a),e}createElement(t){return document.createElement(t)}}},658:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.ObjectTypes=void 0,(i=e.ObjectTypes||(e.ObjectTypes={})).SHEET="list",i.PIPE="pipe",i.SCREW="fix",i.SIZE="size",i.FRAME="frame",i.MATERIAL="material"}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var a=e[s]={exports:{}};return t[s].call(a.exports,a,a.exports,i),a.exports}i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=i(934),e=i(877);i(945);const s=new e.AppModel;new t.AppController(s)})()})();